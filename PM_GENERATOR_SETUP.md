# การปรับปรุง PID Controller สำหรับการสร้าง PM2.5

## วัตถุประสงค์
ปรับปรุงระบบจากการลด PM2.5 เป็นระบบสร้าง PM2.5 เพื่อทดสอบ sensor

## การเปลี่ยนแปลงหลัก

### 1. ทิศทางการคำนวณ Error
```cpp
// สำหรับการสร้าง PM2.5
current_error = target - current;
```
**เหตุผล:** เมื่อค่าปัจจุบันต่ำกว่าเป้าหมาย ต้องการเพิ่มการผลิต PM

### 2. การจัดการเมื่อถึงเป้าหมาย
```cpp
if (current_error <= 0) {
    float minSpeedPercent = 10.0f; // รักษาการผลิตขั้นต่ำ
    integral *= 0.5;
    return minSpeedPercent;
}
```
**เหตุผล:** รักษาการผลิต PM ขั้นต่ำเพื่อป้องกันค่าลดลงเร็วเกินไป

### 3. การปรับ PID Gains สำหรับการสร้าง PM
**ค่าใหม่:**
- **Kp = 0.4** (เพิ่มการตอบสนองสำหรับการผลิต)
- **Ki = 0.008** (ค่าปานกลางเพื่อความแม่นยำ)
- **Kd = 0.05** (ลดเพื่อลด noise ในระบบผลิต)

### 4. การปรับขอบเขตความเร็ว
**สำหรับ target > 20:**
- maxSpeed = 60% (เพิ่มจากเดิม)
- minSpeed = 15% (ลดจากเดิม)

**สำหรับ target ≤ 20:**
- maxSpeed = 45%
- minSpeed = 10%

### 5. การปรับ Integral Limits
- เพิ่ม integralMax เป็น 8.0 สำหรับ target > 20
- ลด integralMin เป็น -3.0 เพื่อลดการ undershoot

### 6. การปรับ Deadband และ Rate Limiting
- เพิ่ม deadband เป็น 8% (จาก 5%) เพื่อความเสถียรในการผลิต
- ลด maxChangeRate เป็น 8%/วินาที เพื่อการเปลี่ยนแปลงที่นุ่มนวล

### 7. การลบ Derivative Sign
```cpp
derivative = (current_error - previous_error) / dt;
```
**เหตุผล:** สำหรับการสร้าง PM ไม่จำเป็นต้องมีเครื่องหมายลบในการคำนวณ derivative

## ข้อดีของการปรับปรุง

1. **การตอบสนองที่เหมาะสม:** ระบบจะเพิ่มการผลิต PM เมื่อค่าต่ำกว่าเป้าหมาย
2. **ความเสถียร:** deadband ที่กว้างขึ้นช่วยลดการแกว่ง
3. **ความปลอดภัย:** รักษาการผลิตขั้นต่ำเพื่อไม่ให้ค่าลดลงรวดเร็ว
4. **ควบคุมได้ดี:** range ความเร็วที่กว้างขึ้นให้การควบคุมที่ละเอียดมากขึ้น

## การใช้งาน

ระบบนี้เหมาะสำหรับ:
- การทดสอบ PM2.5 sensor
- การจำลองสภาพแวดล้อมที่มี PM2.5 สูง
- การ calibrate เครื่องมือวัด PM2.5
- การทดสอบ air purifier หรือระบบกรอง

## คำแนะนำการทดสอบ

1. เริ่มทดสอบด้วย target ต่ำๆ (10-15 µg/m³)
2. สังเกตการตอบสนองและความเสถียร
3. ปรับ PID gains หากจำเป็น:
   - เพิ่ม Kp หากตอบสนองช้า
   - ลด Ki หากมี overshoot
   - เพิ่ม Kd หากมีการแกว่งมาก

## ข้อควรระวัง

1. **ความปลอดภัย:** ใช้ในพื้นที่ที่มีการระบายอากาศดี
2. **การควบคุม:** ตั้งค่า maximum target ไม่ให้สูงเกินไป
3. **การ monitor:** ติดตามค่า PM อย่างสม่ำเสมอ
4. **การหยุดฉุกเฉิน:** มีระบบหยุดการทำงานเมื่อค่าสูงเกินขีดจำกัด
